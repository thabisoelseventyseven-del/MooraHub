@model List<MooraHub.Models.SupportTicket>
@{
    ViewData["Title"] = "My Inbox";
}

<div class="container my-4">

    <div class="glass-card p-4 mb-4 d-flex justify-content-between align-items-start flex-wrap gap-3">
        <div>
            <h2 class="tech-heading mb-1">Inbox</h2>
            <p class="mb-0" style="opacity:.85;">Your requests + admin replies appear here.</p>
        </div>

        <form method="post" asp-controller="Inbox" asp-action="ClearAll">
            @Html.AntiForgeryToken()
            <button class="btn btn-outline-danger">Clear All</button>
        </form>
    </div>

    @if (!Model.Any())
    {
        <div class="glass-card p-4">
            <p class="mb-0">No messages yet. Go to <a href="/Cart/Checkout">Checkout</a> and send your request.</p>
        </div>
    }
    else
    {
        <div class="d-grid gap-3">
            @foreach (var t in Model)
            {
                <div class="glass-card p-4">
                    <div class="d-flex justify-content-between flex-wrap gap-2 align-items-center">
                        <div class="fw-semibold">
                            Request #@t.Id

                            @if (t.UserUnreadReply)
                            {
                                <span class="badge bg-danger ms-2">New Reply</span>
                            }
                        </div>

                        <div style="opacity:.75;">@t.CreatedAt.ToLocalTime()</div>
                    </div>

                    <hr style="opacity:.2;" />

                    <div class="mb-2"><strong>Services:</strong> @t.SelectedServices</div>
                    <div class="mb-2"><strong>Total:</strong> @($"R{t.TotalAmount}")</div>

                    <div class="mb-2">
                        <strong>Status:</strong>
                        <span class="badge bg-secondary">@t.Status</span>
                    </div>

                    <div class="d-flex gap-2 flex-wrap mt-3">
                        <a class="btn btn-primary"
                           asp-controller="Inbox" asp-action="Ticket" asp-route-id="@t.Id">
                            Open
                        </a>

                        <form method="post" asp-controller="Inbox" asp-action="Delete">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="id" value="@t.Id" />
                            <button class="btn btn-outline-danger" type="submit">Delete</button>
                        </form>
                    </div>
                </div>
            }
        </div>
    }
</div>
